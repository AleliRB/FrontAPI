<div class="btn-container">
  <button class="btn-registrar" routerLink="/crear-proveedor">
    <span class="material-icons">local_shipping</span>
    Nuevo Proveedor
  </button>
</div>

@if (proveedores) {
  <table mat-table [dataSource]="proveedores" class="mat-elevation-z8 styled-table">

    <ng-container matColumnDef="RazonSocial">  
      <th mat-header-cell *matHeaderCellDef>Razón Social</th>
      <td mat-cell *matCellDef="let proveedor">{{proveedor.razonSocial}}</td>
    </ng-container>

    <ng-container matColumnDef="Direccion">  
      <th mat-header-cell *matHeaderCellDef>Dirección</th>
      <td mat-cell *matCellDef="let proveedor">{{proveedor.direccion}}</td>
    </ng-container>

    <ng-container matColumnDef="Telefono">  
      <th mat-header-cell *matHeaderCellDef>Teléfono</th>
      <td mat-cell *matCellDef="let proveedor">{{proveedor.telefono}}</td>
    </ng-container>

    <ng-container matColumnDef="Email">  
      <th mat-header-cell *matHeaderCellDef>Email</th>
      <td mat-cell *matCellDef="let proveedor">{{proveedor.email}}</td>
    </ng-container>
    <!-- COLUMNA DE PRODUCTOS CON NOMBRES -->
    <ng-container matColumnDef="Productos">  
      <th mat-header-cell *matHeaderCellDef>Productos</th>
      <td mat-cell *matCellDef="let proveedor">
        <div *ngIf="proveedor.nombresProductos && proveedor.nombresProductos.length > 0">
          <span *ngFor="let nombre of proveedor.nombresProductos; let last = last">
            {{nombre}}<span *ngIf="!last">, </span>
          </span>
        </div>
        <span *ngIf="!proveedor.nombresProductos || proveedor.nombresProductos.length === 0" 
              style="color: #999;">
          Sin productos
        </span>
      </td>
    </ng-container>

    <!-- NUEVA COLUMNA DE PRODUCTOS -->
    <ng-container matColumnDef="TotalProductos">  
      <th mat-header-cell *matHeaderCellDef>Productos</th>
      <td mat-cell *matCellDef="let proveedor">
        <span class="badge-info">{{proveedor.totalProductos}} productos</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="Estado">  
      <th mat-header-cell *matHeaderCellDef>Estado</th>
      <td mat-cell *matCellDef="let proveedor">
        <span 
          *ngIf="proveedor.estado === 'Activo'" 
          class="badge-success"
          (click)="cambiarEstado(proveedor.id, proveedor.estado)"
          style="cursor: pointer;">
          ✓ Activo
        </span>
        <span 
          *ngIf="proveedor.estado === 'Inactivo'" 
          class="badge-warning"
          (click)="cambiarEstado(proveedor.id, proveedor.estado)"
          style="cursor: pointer;">
          ✗ Inactivo
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="Acciones">  
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let proveedor" class="acciones-cell">
        <a mat-flat-button [routerLink]="['/proveedores/editar', proveedor.id]">
          <i class="bi bi-pencil-fill"></i>
        </a>
        <button mat-flat-button color="warn" 
        [swal]="{title:'Confirmación', text: '¿Deseas borrar este registro?', showCancelButton:true}"
        (confirm)="borrar(proveedor.id)">
          <i class="bi bi-trash-fill"></i>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnasAMostrar"></tr>
    <tr mat-row *matRowDef="let row; columns: columnasAMostrar"></tr>

  </table>
}@else {
  <app-loading></app-loading>
}