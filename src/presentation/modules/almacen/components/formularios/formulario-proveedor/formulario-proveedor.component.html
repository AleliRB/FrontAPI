<div class="form-wrapper">
  <h3 class="form-title">{{titulo}}</h3>

  <form (submit)="guardarCambios()" [formGroup]="form">

    <div class="mb-3">
      <label class="form-label">Razón Social</label>
      <input 
        type="text" 
        class="input-field" 
        [class.input-error]="form.controls.razonSocial.invalid && form.controls.razonSocial.touched"
        [formControl]="form.controls.razonSocial" 
        placeholder="Nombre de la empresa">
      <mat-error *ngIf="form.controls.razonSocial.invalid && form.controls.razonSocial.touched">
        La razón social es requerida
      </mat-error>
    </div>

    <div class="mb-3">
      <label class="form-label">Dirección</label>
      <input 
        type="text" 
        class="input-field" 
        [class.input-error]="form.controls.direccion.invalid && form.controls.direccion.touched"
        [formControl]="form.controls.direccion" 
        placeholder="Dirección del proveedor">
      <mat-error *ngIf="form.controls.direccion.invalid && form.controls.direccion.touched">
        La dirección es requerida
      </mat-error>
    </div>

    <div class="mb-3">
      <label class="form-label">Teléfono</label>
      <input 
        type="number" 
        class="input-field" 
        [class.input-error]="form.controls.telefono.invalid && form.controls.telefono.touched"
        [formControl]="form.controls.telefono" 
        placeholder="Número de teléfono">
      <mat-error *ngIf="form.controls.telefono.invalid && form.controls.telefono.touched">
        El teléfono es requerido
      </mat-error>
    </div>

    <div class="mb-3">
      <label class="form-label">Email</label>
      <input 
        type="email" 
        class="input-field" 
        [class.input-error]="form.controls.email.invalid && form.controls.email.touched"
        [formControl]="form.controls.email" 
        placeholder="correo@proveedor.com">
      <mat-error *ngIf="form.controls.email.invalid && form.controls.email.touched">
        <span *ngIf="form.controls.email.hasError('required')">El email es requerido</span>
        <span *ngIf="form.controls.email.hasError('email')">Formato de email inválido</span>
      </mat-error>
    </div>

    <div class="mb-3">
      <label class="form-label">Estado</label>
      <select class="input-field" [formControl]="form.controls.estado">
        <option value="Activo">Activo</option>
        <option value="Inactivo">Inactivo</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Productos que vende</label>
      <div style="max-height: 200px; overflow-y: auto; border: 1px solid #e2e2e2; border-radius: 14px; padding: 12px; background: #f3f3f3;">
        <div *ngFor="let producto of productos" style="margin-bottom: 8px;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input 
              type="checkbox" 
              [checked]="isProductoSeleccionado(producto.idProd)"
              (change)="toggleProducto(producto.idProd, $event)"
              style="margin-right: 8px; cursor: pointer;">
            <span>{{ producto.nombre }}</span>
          </label>
        </div>
        <div *ngIf="productos.length === 0" style="color: #999; text-align: center; padding: 20px;">
          No hay productos disponibles
        </div>
      </div>
      <small class="text-muted" style="display: block; margin-top: 5px;">
        Selecciona los productos que este proveedor suministra
      </small>
    </div>

    <button type="submit" class="btn-submit">Guardar</button>
    <a routerLink="/registro-proveedores" class="btn-cancel">Cancelar</a>
  </form>
</div>